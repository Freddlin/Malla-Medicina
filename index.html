<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FMED - UBA</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #ffffff;
      margin: 0;
      padding: 2rem;
      color: #222;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    header img {
      height: 60px;
    }

    h1 {
      font-size: 2rem;
      font-weight: bold;
      text-align: center;
    }

    h2 {
      background-color: #c999af;
      color: white;
      padding: 0.4rem 1rem;
      margin-bottom: 0;
    }

    h3 {
      background-color: #ddd;
      margin: 0;
      padding: 0.3rem 1rem;
      font-weight: normal;
    }

    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
    }

    .column {
      flex: 1;
      min-width: 250px;
    }

    .subject {
      border: 2px solid #c999af;
      padding: 0.5rem;
      margin: 0.4rem 0;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      position: relative;
      background: #ffe5f0;
    }

    .subject.locked {
      background: #e3b1c8;
      color: #555;
      border-style: dashed;
      cursor: not-allowed;
    }

    .subject.approved {
      background: #fdcae1;
      color: #444;
      text-decoration: line-through;
    }

    .subject:hover:not(.locked):not(.approved) {
      background: #fdcae170;
    }

    .tooltip {
      visibility: hidden;
      background-color: #333;
      color: #fff;
      text-align: center;
      padding: 0.3rem 0.5rem;
      border-radius: 4px;
      position: absolute;
      top: 100%;
      left: 0;
      z-index: 1;
      font-size: 0.75rem;
      white-space: nowrap;
    }

    .subject.locked:hover .tooltip {
      visibility: visible;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo-uba.png" alt="Logo UBA">
    <h1>FMED - UBA</h1>
  </header>

  <div class="grid" id="materias"></div>

  <script>
    const materias = [
      {
        titulo: "CBC",
        items: [
          "Química",
          "Int. Con. Sociedad y Estado",
          "Int. Pensamiento Científico",
          "Matemática",
          "Física e Int. Biofísica",
          "Biología e Int. Biología Celular"
        ]
      },
      {
        titulo: "CICLO BIOMÉDICO*",
        secciones: [
          {
            subtitulo: "PRIMER AÑO",
            items: [
              ["Anatomía", ["CBC"]],
              ["Histología - Biología Celular Embriología - Genética", ["CBC"]],
              ["Salud Mental (1er año)", ["CBC"]],
              ["Bioética I", ["CBC"]],
              ["Medicina Familiar", ["CBC"]]
            ]
          },
          {
            subtitulo: "SEGUNDO AÑO",
            items: [
              ["Química Biológica", ["Anatomía", "Histología - Biología Celular Embriología - Genética"]],
              ["Fisiología y Biofísica", ["Anatomía", "Histología - Biología Celular Embriología - Genética"]]
            ]
          },
          {
            subtitulo: "TERCER AÑO",
            items: [
              ["Microbiología y Parasitología I", ["Química Biológica", "Fisiología y Biofísica"]],
              ["Inmunología Humana", ["Química Biológica", "Fisiología y Biofísica"]],
              ["Microbiología y Parasitología II", ["Microbiología y Parasitología I", "Inmunología Humana"]],
              ["Patología I", ["Química Biológica", "Fisiología y Biofísica"]],
              ["Farmacología I", ["Química Biológica", "Fisiología y Biofísica"]]
            ]
          }
        ]
      },
      {
        titulo: "CICLO CLÍNICO",
        items: [
          ["Medicina A", ["Microbiología y Parasitología I","Inmunología Humana","Patología I","Farmacología I","Salud Mental (1er año)","Bioética I"]],
          ["Patología II", ["Microbiología y Parasitología I","Inmunología Humana","Patología I","Farmacología I","Salud Mental (1er año)","Bioética I"]],
          ["Salud Pública I", ["Microbiología y Parasitología II"]],
          ["Farmacología II", ["Medicina A"]],
          ["Salud Pública II", ["Salud Pública I"]],
          ["Medicina Legal", ["Psiquiatría"]],
          ["Bioética II", ["Bioética I"]],
          ["Toxicología", ["Medicina A","Patología II"]],
          ["Semiología-Fisiopatología", ["Patología I"]]
        ],
        secciones: [
          {
            subtitulo: "CLÍNICAS",
            items: [
              ["Medicina B", ["Medicina A","Patología II"]],
              ["Nutrición", ["Medicina A","Patología II"]],
              ["Diagnóstico por Imágenes", ["Medicina A","Patología II"]],
              ["Dermatología", ["Medicina A","Patología II"]],
              ["Infectología", ["Medicina A","Patología II"]],
              ["Neumonología", ["Medicina A","Patología II"]],
              ["Neurología", ["Medicina A","Patología II"]],
              ["Psiquiatría", ["Medicina A","Patología II"]]
            ]
          },
          {
            subtitulo: "QUIRÚRGICAS",
            items: [
              ["Pediatría", ["Medicina A", "Semiología-Fisiopatología", "Patología II"]],
              ["Obstetricia", ["Medicina A", "Semiología-Fisiopatología", "Patología II"]],
              ["Ginecología", ["Medicina A", "Semiología-Fisiopatología", "Patología II"]],
              ["Cirugía General", ["Medicina A", "Semiología-Fisiopatología", "Patología II"]],
              ["Urología", ["Medicina A", "Semiología-Fisiopatología", "Patología II"]],
              ["Ortopedia-Traumatología", ["Medicina A", "Semiología-Fisiopatología", "Patología II"]],
              ["Oftalmología", ["Medicina A", "Semiología-Fisiopatología", "Patología II"]],
              ["Otorrinolaringología", ["Medicina A", "Semiología-Fisiopatología", "Patología II"]],
              ["Neurocirugía", ["Medicina A", "Semiología-Fisiopatología", "Patología II"]]
            ]
          }
        ]
      },
      {
        titulo: "CICLO INTERNADO ANUAL ROTATORIO",
        items: [
          ["Clínica Médica", ["Ciclo Clínico"]],
          ["Cirugía", ["Ciclo Clínico"]],
          ["Tocoginecología", ["Ciclo Clínico"]],
          ["Pediatría Internado", ["Ciclo Clínico"]],
          ["Salud Mental Internado", ["Ciclo Clínico"]],
          ["APS", ["Ciclo Clínico"]],
          ["Módulo Específico / Curso de Residencia", ["Ciclo Clínico"]]
        ]
      }
    ];

    let approved = new Set(JSON.parse(localStorage.getItem("approvedSubjects") || "[]"));

    const container = document.getElementById("materias");

    function createSubject(name, req = []) {
      const div = document.createElement("div");
      div.className = "subject";
      div.textContent = name;
      div.dataset.name = name;
      div.dataset.req = JSON.stringify(req);
      div.addEventListener("click", () => {
        if (div.classList.contains("locked")) return;
        if (approved.has(name)) approved.delete(name);
        else approved.add(name);
        updateSubjects();
      });
      return div;
    }

    function render() {
      materias.forEach(col => {
        const column = document.createElement("div");
        column.className = "column";

        const h2 = document.createElement("h2");
        h2.textContent = col.titulo;
        column.appendChild(h2);

        if (col.items) {
          col.items.forEach(item => {
            const el = Array.isArray(item) ? createSubject(item[0], item[1]) : createSubject(item);
            column.appendChild(el);
          });
        }

        if (col.secciones) {
          col.secciones.forEach(sec => {
            const h3 = document.createElement("h3");
            h3.textContent = sec.subtitulo;
            column.appendChild(h3);
            sec.items.forEach(([name, req]) => {
              const el = createSubject(name, req);
              column.appendChild(el);
            });
          });
        }

        container.appendChild(column);
      });
    }

    function isCbcComplete() {
      return Array.from(document.querySelectorAll(".column:nth-child(1) .subject")).every(el => approved.has(el.dataset.name));
    }

    function isCicloClinicoComplete() {
      return Array.from(document.querySelectorAll(".column:nth-child(3) .subject")).every(el => approved.has(el.dataset.name));
    }

    function getRequirementText(reqs) {
      if (!reqs.length) return "";
      if (reqs.includes("CBC")) return "Requiere CBC completo";
      if (reqs.includes("Ciclo Clínico")) return "Requiere Ciclo Clínico completo";
      return "Requiere: " + reqs.join(", ");
    }

    function updateSubjects() {
      document.querySelectorAll(".subject").forEach(subj => {
        const name = subj.dataset.name;
        const req = JSON.parse(subj.dataset.req || "[]");
        const isApproved = approved.has(name);
        const allReqMet = req.every(r => r === "CBC" ? isCbcComplete() :
                                         r === "Ciclo Clínico" ? isCicloClinicoComplete() : approved.has(r));

        subj.classList.remove("locked", "approved");
        subj.querySelector(".tooltip")?.remove();

        if (isApproved) {
          subj.classList.add("approved");
        } else if (!allReqMet) {
          subj.classList.add("locked");
          const tooltip = document.createElement("span");
          tooltip.className = "tooltip";
          tooltip.textContent = getRequirementText(req);
          subj.appendChild(tooltip);
        }
      });

      localStorage.setItem("approvedSubjects", JSON.stringify([...approved]));
    }

    render();
    updateSubjects();
  </script>
</body>
</html>
