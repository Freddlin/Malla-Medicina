<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Malla Curricular - Medicina</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 2rem;
    }

    h1 {
      text-align: center;
      margin-bottom: 2rem;
      color: #333;
    }

    .contenedor {
      display: flex;
      overflow-x: auto;
      gap: 2rem;
      padding-bottom: 2rem;
    }

    .columna {
      min-width: 200px;
      background: #fff;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .columna h2 {
      font-size: 1.1rem;
      margin: 0 0 0.5rem;
      text-align: center;
      color: #555;
    }

    .materia {
      padding: 0.6rem;
      background: #e0f7fa;
      border-radius: 8px;
      cursor: pointer;
      position: relative;
      transition: all 0.2s;
      text-align: center;
    }

    .materia:hover {
      transform: translateY(-2px);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .aprobada {
      background: #c8e6c9;
      border: 2px solid #43a047;
      text-decoration: line-through;
      color: #2e7d32;
    }

    .bloqueada {
      background: #eeeeee;
      color: #888;
      cursor: not-allowed;
      position: relative;
    }

    .bloqueada::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 110%;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      white-space: nowrap;
      display: none;
      z-index: 10;
    }

    .bloqueada:hover::after {
      display: block;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular - Medicina</h1>
  <div class="contenedor" id="contenedor"></div>

  <script>
    const estructura = {
      "CBC": [
        "Química",
        "Introducción al Conocimiento de la Sociedad y el Estado",
        "Introducción al Pensamiento Científico",
        "Matemática",
        "Física e Introducción a la Biofísica",
        "Biología e Introducción a la Biología Celular"
      ],
      "1º Año": [
        "Anatomía",
        "Histología-Biología Celular Embriología- Genética",
        "Salud Mental",
        "Bioética I",
        "Medicina Familiar I"
      ],
      "2º Año": [
        "Química Biológica",
        "Fisiología y Biofísica"
      ],
      "3º Año": [
        "Microbiología y Parasitología I",
        "Inmunología Humana",
        "Microbiología y Parasitología II",
        "Patología I",
        "Farmacología I"
      ],
      "Ciclo Clínico": [
        "Medicina A",
        "Patología II",
        "Salud Pública I",
        "Farmacología II",
        "Salud Pública II",
        "Psiquiatría",
        "Medicina Legal Deontología Médica",
        "Bioética II",
        "Toxicología"
      ],
      "Clínicas": [
        "Medicina B Medicina Interna",
        "Nutrición",
        "Diagnóstico por imágenes",
        "Dermatología",
        "Infectología",
        "Neumonología",
        "Neurología",
        "Psiquiatría"
      ],
      "Quirúrgicas": [
        "Pediatría",
        "Obstetricia",
        "Ginecología",
        "Cirugía General",
        "Urología",
        "Ortopedia-Traumatología",
        "Oftalmología",
        "Otorrinolaringología",
        "Neurocirugía"
      ],
      "Internado": [
        "Clínica Médica",
        "Cirugía",
        "Tocoginecología",
        "Pediatría",
        "Salud Mental",
        "APS",
        "Módulo Específico/Curso de Residencia"
      ]
    };

    const correlativas = {
      "Anatomía": ["CBC"],
      "Histología-Biología Celular Embriología- Genética": ["CBC"],
      "Salud Mental": ["CBC"],
      "Bioética I": ["CBC"],
      "Medicina Familiar I": ["CBC"],
      "Química Biológica": ["Histología-Biología Celular Embriología- Genética", "Anatomía"],
      "Fisiología y Biofísica": ["Histología-Biología Celular Embriología- Genética", "Anatomía"],
      "Microbiología y Parasitología I": ["Química Biológica", "Fisiología y Biofísica"],
      "Inmunología Humana": ["Química Biológica", "Fisiología y Biofísica"],
      "Microbiología y Parasitología II": ["Microbiología y Parasitología I", "Inmunología Humana", "Fisiología y Biofísica", "Química Biológica"],
      "Patología I": ["Fisiología y Biofísica", "Química Biológica"],
      "Farmacología I": ["Fisiología y Biofísica", "Química Biológica"],
      "Medicina A": ["Microbiología y Parasitología I", "Inmunología Humana", "Patología I", "Farmacología I", "Salud Mental", "Bioética I"],
      "Patología II": ["Microbiología y Parasitología I", "Inmunología Humana", "Patología I", "Farmacología I", "Salud Mental", "Bioética I"],
      "Salud Pública I": ["Microbiología y Parasitología II"],
      "Farmacología II": ["Medicina A"],
      "Salud Pública II": ["Salud Pública I"],
      "Psiquiatría": ["Medicina A", "Patología II"],
      "Medicina Legal Deontología Médica": ["Psiquiatría"],
      "Bioética II": ["Bioética I"],
      "Toxicología": ["Medicina A", "Patología II"],
      "Medicina B Medicina Interna": ["Medicina A", "Patología II"],
      "Nutrición": ["Medicina A", "Patología II"],
      "Diagnóstico por imágenes": ["Medicina A", "Patología II"],
      "Dermatología": ["Medicina A", "Patología II"],
      "Infectología": ["Medicina A", "Patología II"],
      "Neumonología": ["Medicina A", "Patología II"],
      "Neurología": ["Medicina A", "Patología II"],
      "Pediatría": ["Medicina A", "Patología II"],
      "Obstetricia": ["Medicina A", "Patología II"],
      "Ginecología": ["Medicina A", "Patología II"],
      "Cirugía General": ["Medicina A", "Patología II"],
      "Urología": ["Medicina A", "Patología II"],
      "Ortopedia-Traumatología": ["Medicina A", "Patología II"],
      "Oftalmología": ["Medicina A", "Patología II"],
      "Otorrinolaringología": ["Medicina A", "Patología II"],
      "Neurocirugía": ["Medicina A", "Patología II"],
      "Clínica Médica": ["Ciclo Clínico"],
      "Cirugía": ["Ciclo Clínico"],
      "Tocoginecología": ["Ciclo Clínico"],
      "APS": ["Ciclo Clínico"],
      "Módulo Específico/Curso de Residencia": ["Ciclo Clínico"]
    };

    let aprobadas = JSON.parse(localStorage.getItem("aprobadas")) || [];

    function cumple(nombre) {
      if (!correlativas[nombre]) return true;
      return correlativas[nombre].every(dep => {
        if (dep === "CBC") {
          return estructura["CBC"].every(cbc => aprobadas.includes(cbc));
        } else if (dep === "Ciclo Clínico") {
          return Object.entries(estructura).filter(([g]) => g.startsWith("Ciclo") || g === "Clínicas" || g === "Quirúrgicas").flatMap(([, v]) => v).every(m => aprobadas.includes(m));
        } else {
          return aprobadas.includes(dep);
        }
      });
    }

    function render() {
      const cont = document.getElementById("contenedor");
      cont.innerHTML = "";

      Object.entries(estructura).forEach(([grupo, materias]) => {
        const col = document.createElement("div");
        col.className = "columna";

        const titulo = document.createElement("h2");
        titulo.textContent = grupo;
        col.appendChild(titulo);

        materias.forEach(m => {
          const div = document.createElement("div");
          div.className = "materia";

          const habilitada = cumple(m);
          const estaAprobada = aprobadas.includes(m);

          if (!habilitada && !estaAprobada) {
            div.classList.add("bloqueada");
            const faltantes = (correlativas[m] || []).filter(c => c !== "CBC" && c !== "Ciclo Clínico" && !aprobadas.includes(c));
            div.setAttribute("data-tooltip", "Faltan: " + faltantes.join(", "));
          } else if (estaAprobada) {
            div.classList.add("aprobada");
          }

          div.textContent = m;
          div.onclick = () => {
            if (!habilitada && !estaAprobada) return;
            if (estaAprobada) {
              aprobadas = aprobadas.filter(a => a !== m);
            } else {
              aprobadas.push(m);
            }
            localStorage.setItem("aprobadas", JSON.stringify(aprobadas));
            render();
          };

          col.appendChild(div);
        });

        cont.appendChild(col);
      });
    }

    render();
  </script>
</body>
</html>
